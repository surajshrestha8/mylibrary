{% extends 'shelf/base.html' %}




{% block body %}
{% if messages %}
   
 
   
         {% for message in messages %}
         <div class="alert alert-{{ message.tags }}" role="alert">
          <strong>Message:</strong> {{ message }} 
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          </div> 
         
           
         {% endfor %}
        
    {% endif %}

<div class="card">
  <div class="card-body">
  <form method="GET" action="{% url 'books:issuedbooks' %}">
    <div class="form-row">
      <div class="col-md-2 mb-2">
       
        <select class="form-control" name="book" id="book">
          <option selected >Choose a book</option>
          {% for book  in books %}
          <option value="{{book.id}}">{{book.title}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 mb-2">
       
        <select class="form-control" name="student" id="student">
          <option selected >Select a student:</option>
          {% for student  in  students %}
          <option value="{{student.id}}">{{student.user.username}}</option>
          {% endfor %}
        </select>
      </div>
     
      <div class="col-md-2 mb-2">
       
        <button class="btn btn-primary">Search</button>
      </div>
      
      
  
    </div>
    
  </form>
</div>
         
    <!-- /.card-header -->
   <form method="POST" action="#">
     {% csrf_token %}
    <div class="card-body">
      <table id="example2" class="table table-bordered table-hover table-repsonsive">
        <thead>
        <tr>
          
          <th>Book</th>
          <th>Issued Date</th>
          <th>Return Date</th>
         
          <th>Borrower</th>
          <th>Issued By</th>
          <th>Action</th>
         
        
        
        </tr>
        </thead>
        <tbody>
        {% for books in issuedbooks %}
                        <tr>
                        
                        <td>{{books.book.title}}</td>
                        <td>{{books.issue_date}}</td>
                        <td>{{books.return_date}}</td>
                        
                        <td>{{books.student.user.first_name}} {{books.student.user.last_name}}</td>
                        <td>
                            {{books.issued_by.username}}

                        </td>
                        <td><input type="checkbox" class="depositbooks" name="books_id[]"  value="{{books.id}}" style="width: 15px; height: 15px;"></td>
                      
                      
                       
                    
                    
                    </tr>
                    
        {% endfor %}
                    
        
      </table>
      <hr>
      <span class="errordeposit" style="font-size:15px;color: red; font"></span>
      <button type="submit" class="btn btn-success float-right" id="deposit_button" style="padding: 10px 20px">Deposit</button>
      </div>
      <!-- <a href="{% url 'books:sendmessage' %}" class="btn btn-primary">Get</a> -->
      <!-- <button type="submit" class="btn btn-primary">Deposit</button> -->
      </form>
      {% if issuedbooks.has_other_pages %}
<ul class="pagination">
   {% if issuedbooks.has_previous %}
     <li><a href="?page={{ issuedbooks.previous_page_number }}">«</a></li>
   {% else %}
     <li class="disabled"><span>«</span></li>
{% endif %}
{% for i in issuedbooks.paginator.page_range %}
{% if issuedbooks.number == i %}
 <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
{% else %}
 <li><a href="?page={{ i }}">{{ i }}</a></li>
{% endif %}
{% endfor %}

{% if issuedbooks.has_next %}
<li><a href="?page={{ issuedbooks.next_page_number }}">»</a></li>
{% else %}
<li class="disabled"><span>»</span></li>
{% endif %}
</ul>
{% endif %}
    </div>
    <!-- /.card-body -->





  


<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script>


  $(document).ready( function(){
    $("#deposit_button").click(function(){

        var id = [];
        var csrf = $('input[name=csrfmiddlewaretoken').val()
        
        $(':checkbox:checked').each(function(i){
          id[i]= $(this).val();
        });
        
        if(id.length===0){
          alert('Please select atleast one book')
        }


       
    
      console.log(id);
      $.ajax({
        url: "{% url 'books:depositbooks' %}",
        method: "POST",
        data:{
          id,
          csrfmiddlewaretoken:csrf,
        }
      })
    });
    
  });
</script>

{% endblock %}